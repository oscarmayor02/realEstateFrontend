<div class="container mt-4">
  <h2 class="text-center">Gestión de Usuarios</h2>

  <!-- Buscador -->
  <input
    type="text"
    class="form-control my-3"
    placeholder="Buscar por nombre o email"
    [(ngModel)]="searchTerm"
    (input)="filterUsers()"
  />

  <!-- Tabla / Cards -->
  <div class="table-responsive d-none d-md-block">
    <table class="table table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Email</th>
          <th>Teléfono</th>
          <th>Cédula</th>
          <th>Rol</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of paginatedUsers">
          <td>{{ user.id }}</td>
          <td>{{ user.name }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.telephone }}</td>
          <td>{{ user.cedula }}</td>
          <td>{{ user.role }}</td>
          <td>
            <button
              class="btn btn-sm btn-primary me-2"
              (click)="openEditModal(user)"
            >
              <i class="bi bi-pencil-fill"></i>
            </button>
            <button
              class="btn btn-sm btn-danger"
              (click)="deleteUser(user.id!)"
            >
              <i class="bi bi-trash-fill"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Cards en móviles -->
  <div class="d-md-none">
    <div *ngFor="let user of paginatedUsers" class="card mb-3 shadow-sm">
      <div class="card-body">
        <h5 class="card-title">{{ user.name }}</h5>
        <p class="card-text"><strong>Email:</strong> {{ user.email }}</p>
        <p class="card-text"><strong>Teléfono:</strong> {{ user.telephone }}</p>
        <p class="card-text"><strong>Cédula:</strong> {{ user.cedula }}</p>
        <p class="card-text"><strong>Rol:</strong> {{ user.role }}</p>
        <div class="d-flex justify-content-end">
          <button
            class="btn btn-sm btn-primary me-2"
            (click)="openEditModal(user)"
          >
            <i class="bi bi-pencil-fill"></i>
          </button>
          <button class="btn btn-sm btn-danger" (click)="deleteUser(user.id!)">
            <i class="bi bi-trash-fill"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Paginación -->
  <nav *ngIf="filteredUsers.length > itemsPerPage">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <a class="page-link" (click)="changePage(currentPage - 1)">Anterior</a>
      </li>
      <li
        class="page-item"
        *ngFor="let page of [].constructor(Math.ceil(filteredUsers.length / itemsPerPage)); let i = index"
        [class.active]="currentPage === i + 1"
      >
        <a class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</a>
      </li>
      <li
        class="page-item"
        [class.disabled]="currentPage === Math.ceil(filteredUsers.length / itemsPerPage)"
      >
        <a class="page-link" (click)="changePage(currentPage + 1)">Siguiente</a>
      </li>
    </ul>
  </nav>
</div>

<!-- MODAL DE EDICIÓN -->
<div
  class="modal fade"
  id="editUserModal"
  tabindex="-1"
  aria-labelledby="editUserModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Editar Usuario</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body" *ngIf="selectedUser">
        <form>
          <div class="row">
            <div class="mb-3 col-md-6">
              <label>Nombre</label>
              <input
                class="form-control"
                [(ngModel)]="selectedUser.name"
                name="name"
              />
            </div>
            <div class="mb-3 col-md-6">
              <label>Email</label>
              <input
                class="form-control"
                [(ngModel)]="selectedUser.email"
                name="email"
              />
            </div>
            <div class="mb-3 col-md-6">
              <label>Teléfono</label>
              <input
                class="form-control"
                [(ngModel)]="selectedUser.telephone"
                name="telephone"
              />
            </div>
            <div class="mb-3 col-md-6">
              <label>Cédula</label>
              <input
                class="form-control"
                [(ngModel)]="selectedUser.cedula"
                name="cedula"
                disabled="true"
              />
            </div>
            <div class="mb-3 col-md-12">
              <label>Rol</label>
              <select
                class="form-select"
                [(ngModel)]="selectedUser.role"
                name="role"
              >
                <option value="CLIENT">CLIENT</option>
                <option value="HOST">HOST</option>
                <option value="ADMIN">ADMIN</option>
              </select>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">
          Cancelar
        </button>
        <button class="btn btn-primary" (click)="saveUser()">Guardar</button>
      </div>
    </div>
  </div>
</div>
